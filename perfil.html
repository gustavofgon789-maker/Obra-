<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Perfil | ùîíbra√≠</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { 
      --deep-bg: #0a0f0d;
      --card-bg: #141a17;
      --primary: #10b981;
      --primary-soft: rgba(16, 185, 129, 0.1);
      --danger: #ef4444;
      --text-main: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #1e2923;
    }
    
    body { font-family: 'Inter', sans-serif; background: var(--deep-bg); margin: 0; color: var(--text-main); padding-bottom: 100px; }

    /* Header Premium */
    .profile-header {
        text-align: center;
        padding: 40px 20px;
        background: linear-gradient(180deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
        border-bottom: 1px solid var(--border);
    }

    .profile-img {
        width: 100px; height: 100px;
        border-radius: 50%;
        border: 3px solid var(--primary);
        margin-bottom: 15px;
        object-fit: cover;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
    }

    /* Stats Dashboard */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        padding: 20px;
    }

    .stat-card {
        background: var(--card-bg);
        padding: 15px;
        border-radius: 18px;
        border: 1px solid var(--border);
        text-align: center;
    }

    .stat-value { display: block; font-size: 20px; font-weight: 800; color: var(--primary); }
    .stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

    /* Se√ß√£o de Ferramentas */
    .section-title {
        padding: 20px;
        font-size: 18px;
        font-weight: 700;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .meus-anuncios { padding: 0 20px; }

    .item-anuncio { 
      background: var(--card-bg); 
      border-radius: 20px; 
      padding: 12px; 
      display: flex; 
      align-items: center; 
      margin-bottom: 12px; 
      border: 1px solid var(--border);
    }

    .item-img { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; margin-right: 15px; }
    .item-info { flex-grow: 1; }
    .item-nome { font-weight: 600; font-size: 14px; margin: 0; }
    .item-preco { color: var(--primary); font-size: 13px; font-weight: 700; margin-top: 2px; }

    .acoes-anuncio { display: flex; gap: 8px; }

    .btn-acao {
      width: 35px; height: 35px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      text-decoration: none; font-size: 16px;
      border: 1px solid var(--border);
      cursor: pointer;
    }

    .btn-editar { background: var(--primary-soft); color: var(--primary); }
    .btn-excluir { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

    /* Bot√£o Sair */
    .btn-sair { 
      display: block; margin: 30px 20px; padding: 16px; text-align: center; 
      background: rgba(239, 68, 68, 0.05); color: var(--danger); 
      border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 18px; 
      text-decoration: none; font-weight: 700; font-size: 14px;
    }

    /* Tab Bar */
    .app-footer { 
      position: fixed; bottom: 0; left: 0; right: 0; 
      background: rgba(10, 15, 13, 0.95); backdrop-filter: blur(10px);
      height: 75px; display: flex; justify-content: space-around; 
      align-items: center; border-top: 1px solid var(--border); z-index: 1000;
    }
    .footer-item { text-decoration: none; text-align: center; color: var(--text-muted); font-size: 10px; flex: 1; }
    .footer-item.active { color: var(--primary); font-weight: bold; }
    .btn-add-main {
      background: var(--primary); color: var(--deep-bg); 
      width: 50px; height: 50px; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; 
      text-decoration: none; margin-top: -35px; font-size: 28px; 
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }
  </style>
</head>
<body>

<div class="profile-header">
    <img id="userPhoto" src="" class="profile-img" onerror="this.src='https://via.placeholder.com/100?text=üë§'">
    <h2 id="userName" style="margin:0">Carregando...</h2>
    <p id="userEmail" style="color:var(--text-muted); font-size:14px; margin-top:5px;"></p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <span class="stat-value" id="countAnuncios">0</span>
        <span class="stat-label">An√∫ncios</span>
    </div>
    <div class="stat-card">
        <span class="stat-value">5.0 ‚òÖ</span>
        <span class="stat-label">Avalia√ß√£o</span>
    </div>
</div>

<div class="section-title">
    <span>Minhas Ferramentas</span>
    <button onclick="window.location.href='anunciar.html'" style="background:none; border:none; color:var(--primary); font-weight:700; cursor:pointer;">+ Add</button>
</div>

<div id="listaMeusAnuncios" class="meus-anuncios">
  <p style="text-align: center; color: var(--text-muted); padding: 20px;">A carregar ferramentas...</p>
</div>

<a href="#" id="btnSair" class="btn-sair">Desconectar Conta</a>

<nav class="app-footer">
  <a href="index.html" class="footer-item">üè†<br>In√≠cio</a>
  <a href="anunciar.html" class="btn-add-main">+</a>
  <a href="perfil.html" class="footer-item active">üë§<br>Perfil</a>
</nav>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBLvvoNS4VF2Y0rOh-dHj3GFiwao1D4KYU",
    authDomain: "obrai-56278.firebaseapp.com",
    projectId: "obrai-56278",
    storageBucket: "obrai-56278.firebasestorage.app",
    messagingSenderId: "735990959965",
    appId: "1:735990959965:web:d28f6cbc7b85abfd48e2b4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("userPhoto").src = user.photoURL || '';
      document.getElementById("userName").innerText = user.displayName || 'Membro ùîíbra√≠';
      document.getElementById("userEmail").innerText = user.email;
      carregarMeusAnuncios(user.uid);
    } else {
      window.location.href = "login.html";
    }
  });

  async function carregarMeusAnuncios(userId) {
    const lista = document.getElementById("listaMeusAnuncios");
    try {
      const q = query(collection(db, "anuncios"), where("userId", "==", userId));
      const snap = await getDocs(q);
      lista.innerHTML = "";

      document.getElementById("countAnuncios").innerText = snap.size;

      if (snap.empty) {
        lista.innerHTML = "<p style='text-align:center; color:var(--text-muted); padding: 20px;'>Ainda n√£o tens ferramentas anunciadas.</p>";
        return;
      }

      snap.forEach((docSnap) => {
        const item = docSnap.data();
        const div = document.createElement("div");
        div.className = "item-anuncio";
        div.innerHTML = `
          <img src="${item.imagem}" class="item-img" onerror="this.src='https://via.placeholder.com/100'">
          <div class="item-info">
            <p class="item-nome">${item.nome}</p>
            <p class="item-preco">R$ ${item.preco} / dia</p>
          </div>
          <div class="acoes-anuncio">
            <a href="editar.html?id=${docSnap.id}" class="btn-acao btn-editar">‚úèÔ∏è</a>
            <button class="btn-acao btn-excluir" onclick="confirmarExclusao('${docSnap.id}')">üóëÔ∏è</button>
          </div>
        `;
        lista.appendChild(div);
      });
    } catch (e) {
      console.error(e);
      lista.innerHTML = "<p style='text-align:center; color:var(--danger);'>Erro ao carregar dados.</p>";
    }
  }

  window.confirmarExclusao = async (id) => {
    if (confirm("Desejas remover este an√∫ncio permanentemente?")) {
      try {
        await deleteDoc(doc(db, "anuncios", id));
        location.reload();
      } catch (e) {
        alert("Erro ao excluir o an√∫ncio.");
      }
    }
  };

  document.getElementById("btnSair").addEventListener("click", (e) => {
    e.preventDefault();
    signOut(auth).then(() => {
      window.location.href = "index.html";
    }).catch((error) => {
      alert("Erro ao sair da conta.");
    });
  });
</script>
</body>
</html>
