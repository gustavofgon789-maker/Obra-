<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anunciar</title>

<style>
  body {
    font-family: Arial;
    background: #f4f6f5;
    margin: 0;
  }

  header {
    background: #145c43;
    color: white;
    text-align: center;
    padding: 20px;
  }

  .container {
    max-width: 500px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
  }

  input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  button {
    width: 100%;
    padding: 14px;
    background: #145c43;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
  }

  .msg {
    text-align: center;
    margin-top: 10px;
    color: green;
    font-weight: bold;
  }
</style>
</head>

<body>

<header>
  <h1>Anunciar Ferramenta</h1>
</header>

<div class="container">
  <input type="text" id="nome" placeholder="Nome da ferramenta">
  <input type="text" id="preco" placeholder="Preço por dia">
  <input type="text" id="cidade" placeholder="Cidade">
  <input type="text" id="whatsapp" placeholder="WhatsApp (somente números)">
  <input type="file" id="imagem" accept="image/*">
  <button onclick="publicar()">Publicar</button>
  <div class="msg" id="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBLvvoNS4VF2Y0rOh-dHj3GFiwao1D4KYU",
  authDomain: "obrai-56278.firebaseapp.com",
  projectId: "obrai-56278",
  storageBucket: "obrai-56278.appspot.com",
  messagingSenderId: "735990959965",
  appId: "1:735990959965:web:d28f6cbc7b85abfd48e2b4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

window.publicar = async function() {

  const nome = document.getElementById("nome").value;
  const preco = document.getElementById("preco").value;
  const cidade = document.getElementById("cidade").value;
  const whatsapp = document.getElementById("whatsapp").value;
  const imagemFile = document.getElementById("imagem").files[0];

  if (!imagemFile) {
    alert("Selecione uma imagem");
    return;
  }

  try {

    // cria referência no storage
    const storageRef = ref(storage, "anuncios/" + Date.now() + "_" + imagemFile.name);

    // faz upload
    await uploadBytes(storageRef, imagemFile);

    // pega URL da imagem
    const imageUrl = await getDownloadURL(storageRef);

    // salva no Firestore
    await addDoc(collection(db, "anuncios"), {
      nome,
      preco,
      cidade,
      whatsapp,
      imagem: imageUrl
    });

    alert("Anúncio publicado com imagem!");
    window.location.href = "index.html";

  } catch (error) {
    alert("Erro ao publicar");
    console.error(error);
  }
}
</script>

</body>
</html>
